<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ø¹Ø´Ø§Ø±Ùƒ â€” Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
<link rel="stylesheet" href="styles.css">
<style>
.controls{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:12px}
.table{background:#fff;padding:12px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.06)}
th,td{text-align:center;padding:8px;border-bottom:1px solid #f4f1f3}
.filter-row{display:flex;gap:8px;align-items:center}
.badge{background:#f8bbd0;color:#800; padding:4px 8px;border-radius:8px;font-weight:700}
</style>
</head>
<body>
  <div class="header">ğŸ§¾ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª â€” Ø¹Ø´Ø§Ø±Ùƒ</div>
  <div class="container">
    <div class="controls">
      <div class="filter-row">
        <select id="storeFilter"><option value="all">ÙƒÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø±</option></select>
        <select id="statusFilter"><option value="all">ÙƒÙ„ Ø§Ù„Ø­Ø§Ù„Ø§Øª</option><option value="new">Ø¬Ø¯ÙŠØ¯Ø©</option><option value="ready">Ø¬Ø§Ù‡Ø²Ø©</option><option value="completed">Ù…ÙƒØªÙ…Ù„Ø©</option></select>
        <input id="searchBox" class="search" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… Ø£Ùˆ Ø§Ù„Ù‡Ø§ØªÙ" oninput="renderOrders()">
      </div>
      <div>
        <button class="btn" onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
        <button class="btn ghost" onclick="clearOrdersConfirm()">ğŸ—‘ï¸ Ø­Ø°Ù Ø§Ù„ÙƒÙ„</button>
      </div>
    </div>

    <div id="ordersTable" class="table">
      <table style="width:100%;border-collapse:collapse">
        <thead><tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ù…ØªØ¬Ø±</th><th>Ø§Ù„Ù…Ù†ØªØ¬/Ø§Ù„ØªÙØ§ØµÙŠÙ„</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th><th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th></tr></thead>
        <tbody id="ordersBody"></tbody>
      </table>
    </div>
  </div>

<script>
function load(k, fallback){ try{ return JSON.parse(localStorage.getItem(k)) || fallback }catch(e){ return fallback } }
function save(k,v){ localStorage.setItem(k, JSON.stringify(v)) }
let stores = load('stores', []);
let orders = load('orders', []);
const storeFilter = document.getElementById('storeFilter');
const statusFilter = document.getElementById('statusFilter');

function fillStoreFilter(){
  storeFilter.innerHTML = '<option value="all">ÙƒÙ„ Ø§Ù„Ù…ØªØ§Ø¬Ø±</option>';
  stores.forEach(s=> storeFilter.innerHTML += `<option value="${s.id}">${s.name}</option>`);
}
function renderOrders(){
  orders = load('orders', []);
  const tbody = document.getElementById('ordersBody');
  tbody.innerHTML = '';
  const sFilter = storeFilter.value;
  const stFilter = statusFilter.value;
  const q = (document.getElementById('searchBox').value||'').toLowerCase();
  const filtered = orders.filter(o=>{
    if(sFilter !== 'all' && o.storeId !== sFilter) return false;
    if(stFilter !== 'all' && o.status !== stFilter) return false;
    if(q){
      return (o.customerName||'').toLowerCase().includes(q) || (o.customerPhone||'').includes(q) || (o.productName||'').toLowerCase().includes(q);
    }
    return true;
  });
  if(!filtered.length){ tbody.innerHTML = '<tr><td colspan="8" class="small-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø·Ø§Ø¨Ù‚Ø©</td></tr>'; return; }
  filtered.forEach(o=>{
    const store = stores.find(s=>s.id===o.storeId);
    tbody.innerHTML += `<tr>
      <td>${o.customerName}</td>
      <td>${o.customerPhone}</td>
      <td>${store?store.name:'-'}</td>
      <td>${o.productName || `${o.count} Ã— ØªØ®ØµÙŠØµ`}</td>
      <td>${o.totalPrice}</td>
      <td>${o.time}</td>
      <td>${o.status}</td>
      <td>
        <button class="btn ghost" onclick="changeStatus('${o.id}','ready')">âœ” Ø¬Ø§Ù‡Ø²</button>
        <button class="btn ghost" onclick="changeStatus('${o.id}','completed')">âœ… Ù…ÙƒØªÙ…Ù„</button>
        <button class="btn ghost" onclick="deleteOrder('${o.id}')">Ø­Ø°Ù</button>
      </td>
    </tr>`;
  });
}

function changeStatus(id, status){
  orders = load('orders', []);
  const o = orders.find(x=>x.id===id);
  if(!o) return;
  o.status = status;
  save('orders', orders);
  renderOrders();
}
function deleteOrder(id){
  if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
  orders = load('orders', []).filter(x=>x.id!==id); save('orders', orders); renderOrders();
}
function clearOrdersConfirm(){
  if(!confirm('Ø­Ø°Ù ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ')) return;
  localStorage.removeItem('orders'); orders = []; renderOrders();
}

/* init */
fillStoreFilter();
renderOrders();
storeFilter.addEventListener('change', renderOrders);
statusFilter.addEventListener('change', renderOrders);
</script>
</body>
</html>
